{% load static %}
<article onclick="window.location.href='{% url 'main:view_product' product.id %}'" class="overflow-hidden rounded-lg border border-gray-200 bg-white transition-shadow duration-300 hover:shadow-lg">
  <!-- Thumbnail -->
  <div class="relative aspect-[16/9] overflow-hidden">
  {% if product.thumbnail %}
  <img src="{{ product.thumbnail }}" alt="{{ product.title }}" class="{% if not product.is_stock_available %}grayscale opacity-50{% endif %} h-full w-full object-center object-cover" />
  {% if not product.is_stock_available %}
  <div class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-40">
    <span class="-rotate-12 transform text-2xl font-bold text-white">OUT OF STOCK!</span>
  </div>
  {% endif %}
  {% else %}
  <div class="h-full w-full bg-gray-200"></div>
  {% endif %}

  <!-- Status Badges -->
  <div class="absolute top-3 right-3 flex space-x-2">
    {% if product.is_featured %}
    <span class="inline-flex items-center rounded-full bg-yellow-500 px-2 py-1 text-xs font-medium text-yellow-50"> ★ Featured  </span>
    {% endif %}
    {% if product.rating >= 4.5 %}
    <span class="inline-flex items-center rounded-full bg-red-100 px-2 py-1 text-xs font-medium text-red-800"> Top Rating! </span>
    {% endif %}
  </div>
</div>

  <!-- Content -->
  <div class="p-5">
    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-gray-600 text-white mb-3">{{ product.get_category_display }}</span>

    <h3 class="mb-3 line-clamp-2 text-lg leading-tight font-semibold text-gray-900">
      <a href="{% url 'main:view_product' product.id %}" class="transition-colors hover:text-green-600"> {{ product.name }} </a>
        <p class="text-sm text-gray-500">{% if product.brand %} {{ product.brand }} {% else %} Unknown brand {% endif %}</p>
    </h3>

    <h3 class="mt-3 line-clamp-2 text-lg leading-tight font-semibold text-gray-900 flex justify-end">
      <a href="{% url 'main:view_product' product.id %}"> ${{ product.price }} </a>
    </h3>

    <div class="flex items-center justify-between">
  <!-- Rating Stars -->
  <div class="flex items-center">
    {% with full_stars=product.rating|floatformat:0|add:0 has_half=product.rating|floatformat:1|slice:"-1:"|add:0 %}
      {% for i in "12345" %}
        {% if forloop.counter <= full_stars %}
          <span class="text-yellow-400 text-xl">★</span>
        {% elif forloop.counter == full_stars|add:1 and has_half >= 5 %}
          <span class="text-yellow-400 text-xl">⯨</span>
        {% else %}
          <span class="text-gray-300 text-xl">☆</span>
        {% endif %}
      {% endfor %}
    {% endwith %}
    <span class="ml-2 text-sm text-gray-600">({{ product.rating }})</span>
  </div>

  <!-- Buttons -->
    {% if user.is_authenticated and product.user == user %}
  <div class="flex items-center gap-2">
    <a href="{% url 'main:edit_product' product.id %}" class="text-blue-500 hover:text-blue-700">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
      </svg>
    </a>
    <a href="{% url 'main:delete_product' product.id %}" class="text-red-500 hover:text-red-700">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
      </svg>
    </a>
  </div>
</div>
  {% endif %}
  </div>


</article>
